{"version":3,"sources":["../../utils/apiFeatures.js"],"names":["APIFeatures","query","queryString","queryObj","excludedFields","forEach","el","queryStr","JSON","stringify","replace","match","find","parse","sort","sortBy","split","join","fields","select","page","limit","skip"],"mappings":";;;;;;;;;;;;;;;;;;;IAAMA,W;AACF,uBAAYC,KAAZ,EAAmBC,WAAnB,EAAgC;AAAA;AAC5B,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACH;;;;WAED,kBAAS;AACL,UAAMC,QAAQ,qBAAQ,KAAKD,WAAb,CAAd;;AACA,UAAME,cAAc,GAAG,CAAC,MAAD,EAAS,MAAT,EAAiB,OAAjB,EAA0B,QAA1B,CAAvB;AACAA,MAAAA,cAAc,CAACC,OAAf,CAAuB,UAACC,EAAD;AAAA,eAAQ,OAAOH,QAAQ,CAACG,EAAD,CAAvB;AAAA,OAAvB,EAHK,CAKL;;AACA,UAAIC,QAAQ,GAAGC,IAAI,CAACC,SAAL,CAAeN,QAAf,CAAf;AACAI,MAAAA,QAAQ,GAAGA,QAAQ,CAACG,OAAT,CACP,sBADO,EAEP,UAACC,KAAD;AAAA,0BAAeA,KAAf;AAAA,OAFO,CAAX;AAKA,WAAKV,KAAL,CAAWW,IAAX,CAAgBJ,IAAI,CAACK,KAAL,CAAWN,QAAX,CAAhB,EAZK,CAaL;;AAEA,aAAO,IAAP;AACH;;;WAED,gBAAO;AACH,UAAI,KAAKL,WAAL,CAAiBY,IAArB,EAA2B;AACvB,YAAMC,MAAM,GAAG,KAAKb,WAAL,CAAiBY,IAAjB,CAAsBE,KAAtB,CAA4B,GAA5B,EAAiCC,IAAjC,CAAsC,GAAtC,CAAf;AACA,aAAKhB,KAAL,GAAa,KAAKA,KAAL,CAAWa,IAAX,CAAgBC,MAAhB,CAAb;AACH,OAHD,MAGO;AACH,aAAKd,KAAL,GAAa,KAAKA,KAAL,CAAWa,IAAX,CAAgB,WAAhB,CAAb;AACH;;AACD,aAAO,IAAP;AACH;;;WAED,uBAAc;AACV,UAAI,KAAKZ,WAAL,CAAiBgB,MAArB,EAA6B;AACzB,YAAMA,MAAM,GAAG,KAAKhB,WAAL,CAAiBgB,MAAjB,CAAwBF,KAAxB,CAA8B,GAA9B,EAAmCC,IAAnC,CAAwC,GAAxC,CAAf;AACA,aAAKhB,KAAL,GAAa,KAAKA,KAAL,CAAWkB,MAAX,CAAkBD,MAAlB,CAAb;AACH,OAHD,MAGO;AACH,aAAKjB,KAAL,GAAa,KAAKA,KAAL,CAAWkB,MAAX,CAAkB,MAAlB,CAAb;AACH;;AAED,aAAO,IAAP;AACH;;;WAED,oBAAW;AACP,UAAMC,IAAI,GAAG,KAAKlB,WAAL,CAAiBkB,IAAjB,GAAwB,CAAxB,IAA6B,CAA1C;AACA,UAAMC,KAAK,GAAG,KAAKnB,WAAL,CAAiBmB,KAAjB,GAAyB,CAAzB,IAA8B,GAA5C;AACA,UAAMC,IAAI,GAAG,CAACF,IAAI,GAAG,CAAR,IAAaC,KAA1B;AAEA,WAAKpB,KAAL,GAAa,KAAKA,KAAL,CAAWqB,IAAX,CAAgBA,IAAhB,EAAsBD,KAAtB,CAA4BA,KAA5B,CAAb;AAEA,aAAO,IAAP;AACH;;;;;eAGUrB,W","sourcesContent":["class APIFeatures {\r\n    constructor(query, queryString) {\r\n        this.query = query\r\n        this.queryString = queryString\r\n    }\r\n\r\n    filter() {\r\n        const queryObj = { ...this.queryString }\r\n        const excludedFields = ['page', 'sort', 'limit', 'fields']\r\n        excludedFields.forEach((el) => delete queryObj[el])\r\n\r\n        // 1B) Advanced filtering\r\n        let queryStr = JSON.stringify(queryObj)\r\n        queryStr = queryStr.replace(\r\n            /\\b(gte|gt|lte|lt)\\b/g,\r\n            (match) => `$${match}`\r\n        )\r\n\r\n        this.query.find(JSON.parse(queryStr))\r\n        // let query = Tour.find(JSON.parse(queryStr))\r\n\r\n        return this\r\n    }\r\n\r\n    sort() {\r\n        if (this.queryString.sort) {\r\n            const sortBy = this.queryString.sort.split(',').join(' ')\r\n            this.query = this.query.sort(sortBy)\r\n        } else {\r\n            this.query = this.query.sort('-createAt')\r\n        }\r\n        return this\r\n    }\r\n\r\n    limitFields() {\r\n        if (this.queryString.fields) {\r\n            const fields = this.queryString.fields.split(',').join(' ')\r\n            this.query = this.query.select(fields)\r\n        } else {\r\n            this.query = this.query.select('-__v')\r\n        }\r\n\r\n        return this\r\n    }\r\n\r\n    paginate() {\r\n        const page = this.queryString.page * 1 || 1\r\n        const limit = this.queryString.limit * 1 || 100\r\n        const skip = (page - 1) * limit\r\n\r\n        this.query = this.query.skip(skip).limit(limit)\r\n\r\n        return this\r\n    }\r\n}\r\n\r\nexport default APIFeatures\r\n"],"file":"apiFeatures.js"}